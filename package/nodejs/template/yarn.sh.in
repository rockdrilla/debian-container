#!/bin/sh
# SPDX-License-Identifier: Apache-2.0
# (c) 2022-2023, Konstantin Demin

set -ef

reparse_path() {
	tr ':' '\0' \
	| grep -zEv '^/@{NODEJS_PREFIX}/bin$' \
	| paste -zsd':' \
	| tr -d '\0'
}

set +e
__new=$(printf '%s' "${PATH}" | reparse_path)
set -e
export PATH="/@{NODEJS_PREFIX}/bin:${__new}"
unset __new

exec /@{NODEJS_BINARY} /@{NODEJS_MODULES}/yarn/bin/yarn.js "$@"
